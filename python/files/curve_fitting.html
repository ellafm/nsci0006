

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>8. Curve fitting &#8212; NSCI0006 : Getting started with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/_static/mystyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyle.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'files/curve_fitting';</script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="7. Numeric calculus" href="numeric_calculus.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><h1>NSCI0006 : Getting started with Python</h1></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.ucl.ac.uk/module-catalogue/modules/mathematics-for-natural-sciences-b-NSCI0006" title="Catalogue" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-book-open"></i></span>
            <label class="sr-only">Catalogue</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://timetable.ucl.ac.uk/tt/moduleTimet.do?firstReq=Y&moduleId=NSCI0006&acadYearFl=N" title="Timetable" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-calendar-days"></i></span>
            <label class="sr-only">Timetable</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://moodle.ucl.ac.uk/course/view.php?id=34403" title="Moodle" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/moodle_original_logo_icon_146420.png" class="icon-link-image" alt="Moodle"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><h1>NSCI0006 : Getting started with Python</h1></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.ucl.ac.uk/module-catalogue/modules/mathematics-for-natural-sciences-b-NSCI0006" title="Catalogue" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-book-open"></i></span>
            <label class="sr-only">Catalogue</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://timetable.ucl.ac.uk/tt/moduleTimet.do?firstReq=Y&moduleId=NSCI0006&acadYearFl=N" title="Timetable" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-calendar-days"></i></span>
            <label class="sr-only">Timetable</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://moodle.ucl.ac.uk/course/view.php?id=34403" title="Moodle" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/moodle_original_logo_icon_146420.png" class="icon-link-image" alt="Moodle"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-light.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo-dark.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cocalc.html">Using CoCalc</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Function glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="fundamentals.html">1. Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="lists_and_loops.html">2. Lists and loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="arrays_and_plots.html">3. Arrays and plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_data.html">4. Working with data</a></li>
<li class="toctree-l1"><a class="reference internal" href="iterative_methods.html">5. Iterative methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="function_definition.html">6. Function definition</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="numeric_calculus.html">7. Numeric calculus</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Curve fitting</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Curve fitting</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> On this page </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-data">8.1. Defining the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-to-linear-form">8.2. Reduction to linear form</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-nonlinear-model">8.3. Fitting a nonlinear model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-comparison">8.4. Results comparison</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="curve-fitting">
<h1><span class="section-number">8. </span>Curve fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this heading">#</a></h1>
<p>After completing the chapter you should be able to fit a given model function to a dataset to obtain estimates of unknown coefficients</p>
<p>The chapter introduces two approaches and you should be able to use both:</p>
<ul class="simple">
<li><p>Fit a straight line to linear data using <code class="docutils literal notranslate"><span class="pre">polyfit</span></code> from the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> library.</p></li>
<li><p>Fit a model function to nonlinear data using <code class="docutils literal notranslate"><span class="pre">optimize.curve_fit</span></code> from the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> library.</p></li>
</ul>
<section id="defining-the-data">
<h2><span class="section-number">8.1. </span>Defining the data<a class="headerlink" href="#defining-the-data" title="Permalink to this heading">#</a></h2>
<p>We will demonstrate the steps involved by fitting the data given in the table below to the exponential decay model</p>
<div class="amsmath math notranslate nohighlight" id="equation-8f4a279f-62a5-4e86-92cd-9ad439baf215">
<span class="eqno">(8.1)<a class="headerlink" href="#equation-8f4a279f-62a5-4e86-92cd-9ad439baf215" title="Permalink to this equation">#</a></span>\[\begin{equation}
y=Ae^{-kx}
\end{equation}\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>distance (cm)</p></th>
<th class="head"><p>dose (Gy)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.1</p></td>
<td><p>15.00</p></td>
</tr>
<tr class="row-odd"><td><p>0.2</p></td>
<td><p>12.50</p></td>
</tr>
<tr class="row-even"><td><p>0.5</p></td>
<td><p>8.75</p></td>
</tr>
<tr class="row-odd"><td><p>1.0</p></td>
<td><p>5.00</p></td>
</tr>
<tr class="row-even"><td><p>2.7</p></td>
<td><p>1.00</p></td>
</tr>
</tbody>
</table>
<div class="dropdown admonition">
<p class="admonition-title">About this dataset</p>
<p>The experimental values given in the table were quoted in a research paper on <a class="reference external" href="https://doi.org/10.1016/j.jtbi.2005.11.015">Mathematical Modelling of Radiotherapy Strategies for Early Breast Cancer</a>, an electron-beam driven x-ray source was used to deliver radiation to a taget site. The data illustrates how the amount of radiation at the site depends on the distance between the x-ray source and the target</p>
</div>
<p>We could define this data by importing it from a csv file, as we did in <a class="reference internal" href="working_with_data.html#ch-wdata"><span class="std std-numref">Section 4</span></a>, but since the dataset is small we will simply type it out by hand for this example. The data should be in numpy array format so that mathematical operations can be performed with the array variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.7</span><span class="p">])</span>             <span class="c1">#distance</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">15.00</span><span class="p">,</span><span class="mf">12.50</span><span class="p">,</span><span class="mf">8.75</span><span class="p">,</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">1.00</span><span class="p">])</span>    <span class="c1">#dose</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reduction-to-linear-form">
<span id="sec-linf"></span><h2><span class="section-number">8.2. </span>Reduction to linear form<a class="headerlink" href="#reduction-to-linear-form" title="Permalink to this heading">#</a></h2>
<p>In this case, we can reduce the model to linear form by taking logarithm of both sides of the equation</p>
<div class="math notranslate nohighlight" id="equation-aeminuskx">
<span class="eqno">(8.2)<a class="headerlink" href="#equation-aeminuskx" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{align}
\ln(y)&amp;=\ln(Ae^{-kx})\\
       &amp;=\ln(A)-kx.
\end{align}\end{split}\]</div>
<p>A plot of <span class="math notranslate nohighlight">\((x,\ln(y))\)</span> should resemble a straight line with slope <span class="math notranslate nohighlight">\(-k\)</span> and intercept the vertical axis at <span class="math notranslate nohighlight">\(\ln(A)\)</span>.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lny</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>                 <span class="c1">#ln(dose)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lny</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>          <span class="c1">#plot the data using red markers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance /cm&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ln(dose /Gy)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can fit a straight line in Python by using the <code class="docutils literal notranslate"><span class="pre">polyfit</span></code> function from the numpy library to fit a one-degree polynomial. Note that here we are fitting to the <span class="math notranslate nohighlight">\((x,\ln(y))\)</span> data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lny</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">#calculate the best fit lny=mx+c</span>
</pre></div>
</div>
</div>
</div>
<div class="dropdown admonition">
<p class="admonition-title">About polyfit</p>
<p>This function is designed to fit a polynomial to data. It uses the following syntax, where <code class="docutils literal notranslate"><span class="pre">deg</span></code> is the degree of the polynomial that we want to fit:</p>
<p>The output is a list of the coefficients in descending power order. If we declare a single output variable <code class="docutils literal notranslate"><span class="pre">coeffs</span></code> this will be the list object, whilst if we declare multiple output variables the list values will be distributed to the variable names. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="o">%</span><span class="n">fit</span> <span class="n">y</span><span class="o">=</span><span class="n">mx</span><span class="o">+</span><span class="n">c</span>
</pre></div>
</div>
</div>
<p>Finally, to plot the line we can use the coefficients <code class="docutils literal notranslate"><span class="pre">m,c</span></code> that were found. Since we are plotting a straight line, we just need to evaluate the end-points of the line we want to plot, and join these up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>      <span class="c1">#x values</span>
<span class="n">yy</span><span class="o">=</span><span class="n">m</span><span class="o">*</span><span class="n">xx</span><span class="o">+</span><span class="n">c</span>               <span class="c1">#fitted line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>   <span class="c1">#plot the fitted line</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/8766fa499da285411bcb90064b410aa13a2912c7bc873469fc706b24a8c5c064.png" src="../_images/8766fa499da285411bcb90064b410aa13a2912c7bc873469fc706b24a8c5c064.png" />
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Avoid label conflict</p>
<p>Notice that to for the fitted line we used data labels <code class="docutils literal notranslate"><span class="pre">xx</span></code> and <code class="docutils literal notranslate"><span class="pre">yy</span></code> to avoid conflict with the data labels <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</div>
</section>
<section id="fitting-a-nonlinear-model">
<span id="sec-datafit"></span><h2><span class="section-number">8.3. </span>Fitting a nonlinear model<a class="headerlink" href="#fitting-a-nonlinear-model" title="Permalink to this heading">#</a></h2>
<p>Fitting a straight line or higher degree polynomial is not sufficient for every problem. In this section we outline a more general approach that allows a nonlinear model to be fitted to a given dataset. We will apply the method to the electron beam data to demonstrate.</p>
<p>The method involves using an algorithm from the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> toolbox to find optimised estimates of the coefficients. To use the algorithm, we first need to define the model:</p>
<h4>Define the model</h4>
<p>We will define the model by creating our own function. The input pattern should have the independent variable <code class="docutils literal notranslate"><span class="pre">x</span></code> first, followed by the unknown constants. This is important due to the method that we will use to fit the data. The constants can be listed in any order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>At this point, it may be helpful to plot the data together with the model function, experimenting with the parameters to see if we can get something close to a good fit. With only two parameters it is fairly easy to get a reasonable fit by trial and error. The more parameters there are in the model, the harder this may become:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>               <span class="c1">#plot the data using red markers</span>

<span class="n">xx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>              <span class="c1">#generate x data for the curve</span>
<span class="n">yy</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>               <span class="c1">#generate y data using A=16,k=1.1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>              <span class="c1">#plot the curve data in black</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;dose (Gy)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3404b111ff267471a2ec19e61c44b87a508fa6e7ea51cd0e9c53b9d5d012182c.png" src="../_images/3404b111ff267471a2ec19e61c44b87a508fa6e7ea51cd0e9c53b9d5d012182c.png" />
</div>
</div>
<h4>Fit the model to the data</h4>
<p>We will use an optimization algorithm from the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> library to obtain a “best” fit for the unknown constants. The best fit is defined to be the one that minimises the sum of the squared errors between the curve and the datapoints.</p>
<div class="readmore admonition">
<p class="admonition-title">Read more</p>
<p>If you are interested to learn about the method of least squares, you can find further information <a class="reference external" href="https://www.jmp.com/en_gb/statistics-knowledge-portal/what-is-regression/the-method-of-least-squares.html">here</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="n">coeffs</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[16.18743474  1.13744585]
</pre></div>
</div>
</div>
</div>
<p>Note: We write <code class="docutils literal notranslate"><span class="pre">coeffs,_</span></code> because the <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> function returns two outputs and we only want to keep the first one that contains the fitted coefficients.</p>
<p>The output that we have labelled as <code class="docutils literal notranslate"><span class="pre">coeffs</span></code> is an array containing the fitted constants in the order that they were listed in our function model. Therefore we have found the following results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">coeffs</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A=&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k=&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A= 16.187434739478817
k= 1.1374458547038973
</pre></div>
</div>
</div>
</div>
<p>Once we have obtained the constants, they can be used to plot the best fit curve for comparison to the dataset.</p>
</section>
<section id="results-comparison">
<h2><span class="section-number">8.4. </span>Results comparison<a class="headerlink" href="#results-comparison" title="Permalink to this heading">#</a></h2>
<p>Linearisation and nonlinear model fitting do not give the same results. We can make a comparison of the two estimates by plotting both of them together with the original data. To do this for the linear fit, we need to use the relationships between the constants <span class="math notranslate nohighlight">\(A,k\)</span> and the linear coefficients <span class="math notranslate nohighlight">\(m,c\)</span> that we found. Equation <a class="reference internal" href="#equation-aeminuskx">(8.2)</a> gives</p>
<div class="amsmath math notranslate nohighlight" id="equation-af9036ae-76a9-41d0-89b8-f9a05f913434">
<span class="eqno">(8.3)<a class="headerlink" href="#equation-af9036ae-76a9-41d0-89b8-f9a05f913434" title="Permalink to this equation">#</a></span>\[\begin{align}
m&amp;=-k     \qquad &amp;&amp;\implies \quad k=-m\\
c&amp;=\ln(A) \qquad &amp;&amp;\implies \quad A=e^{c}
\end{align}\]</div>
<p>Therefore, we can use the following code to plot the two curves together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>

<span class="n">yy</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>      
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;nonlinear fit&quot;</span><span class="p">)</span>

<span class="n">yy</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;linear fit&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;dose (Gy)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e3fbe92372a856aaf3848497a1cd1d8f5e3078c0959ab4fae34dddc80d98bd1e.png" src="../_images/e3fbe92372a856aaf3848497a1cd1d8f5e3078c0959ab4fae34dddc80d98bd1e.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./files"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="numeric_calculus.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Numeric calculus</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-data">8.1. Defining the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reduction-to-linear-form">8.2. Reduction to linear form</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-nonlinear-model">8.3. Fitting a nonlinear model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-comparison">8.4. Results comparison</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ella Metcalfe
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>